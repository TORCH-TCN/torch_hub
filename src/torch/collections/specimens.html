{% extends "base.html" %} {% block title %}Specimens{% endblock %} {% block
content %}

<div x-data="specimens({{collection.id}})" class="page-container">
  <div class="back-page">
    <button @click="history.back()">
      <img src="../static//images/arrow-left.svg" alt="Left arrow" />
      <p class="xsmall">Back</p>
    </button>
  </div>
  <div class="page-container-header">
    <div class="left">
      <h5 class="mb-0">{{collection.name}}</h5>
    </div>
    <div class="right searchbar">
      <input
        class="search-input"
        type="text"
        placeholder="Search"
        x-model="search"
        @keyup="searchSpecimen()"
      />
      <button x-on:click="searchSpecimen()">
        <i class="fa fa-search" style="font-size: 18px"> </i>
      </button>
    </div>
  </div>
  <div class="main-container">
    <div class="main-container-header">
      <div class="left">
        <p class="xsmall">All / {{collection.code}}</p>
      </div>
      <!-- <div class="right">
        <div class="list-sort">
          <p class="xsmall">View list</p>
          <img
            src="../static//images/down-filled-triangular-arrow.png"
            alt="Down arrow"
          />
        </div>
        <div class="list-sort">
          <p class="xsmall">Sort</p>
          <img
            src="../static//images/down-filled-triangular-arrow.png"
            alt="Down arrow"
          />
        </div>
      </div> -->
    </div>
    <div class="main-container-body p-4">
      <template x-if="loading">
        <div class="spinner-element">
        <div class="spinner-border text-secondary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        </div>
      </template>
      <template x-if="!loading">
      <div class="row-collection">
        <!-- Modal -->
        <div>
          <button @click="open=true">
            <div>
              <div class="add-collection">
                <img src="../static//images/plus.png" alt="Plus icon" />
                <p>New specimen</p>
              </div>
            </div>
          </button>
          <template x-teleport="body">
            <!-- Backdrop -->
            <div x-show="open" class="modal fade show">
              <div class="modal-dialog-specimen">
                <!-- Dialog -->
                <div x-show="open" x-transition class="modal-content">
                  <!-- mousedown.outside="open = false" -->
                  <!-- Modal Title -->
                  <div class="modal-header specimen">
                    <h5 class="modal-title"></h5>
                    <button @click="open = false" class="btn-close">X</button>
                  </div>

                  <!-- Modal Body -->
                  <div class="p-4">
                    <div class="form-group">
                      <div class="upload-box">
                        <form
                          id="dropbox"
                          action="{{ url_for('collections.upload', collectionid=collection.code) }}"
                          class="dropzone"
                        >
                          <div class="dz-message" data-dz-message>
                            <span style="color: #667085">
                              <img
                                src="../static/images/upload_icon.svg"
                                alt="Upload cloud icon"
                              /><br />
                              <span style="color: #6941c6"
                                >Click to upload</span
                              >
                              or drag and drop<br />
                              PNG or JPG</span
                            >
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <div class="modal-backdrop fade show" x-show="open"></div>
        </div>

        <template x-for="s in specimens">
          <div>
            <div
              class="collection-card"
              :alt="s.name"
              x-on:click="openPage(s.id)"
            >
              <div x-data="{ open: false }" class="menu-dropdown">
                <button @click="open = ! open" class="menu-dropbtn" @click.stop>
                  <img src="../static/images/list.png" alt="menu" />
                </button>
                <div
                  x-show="open"
                  @click.outside="open = false"
                  class="menu-dropdown-content"
                >
                  <p class="xsmall">Delete</p>
                </div>
              </div>

              <img
                :src="s.upload_path"
                :alt="s.name"
                x-show="s.flow_run_state != 'Failed'"
              />
              <img
                src="../static/images/error.png"
                :alt="s.name"
                x-show="s.flow_run_state == 'Failed'"
              />
              <div class="card-body">
                <h5 x-text="s.name"></h5>
                <p
                  x-text="s.create_date"
                  x-show="(!s.progress || s.progress == 100) && s.flow_run_state == 'Completed'"
                ></p>
                <div
                  class="progress"
                  x-show="s.progress && s.flow_run_state == 'Running'"
                >
                  <div
                    class="progress-bar bg-success"
                    role="progressbar"
                    :style="s.style"
                    :aria-valuenow="s.progress"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                  <!-- <div class="progress-bar bg-danger" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                                  <div class="progress-bar bg-warning" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div> -->
                </div>
                <p class="text-danger" x-show="s.flow_run_state == 'Failed'">
                  Error
                </p>
              </div>
            </div>
          </div>
        </template>
      </div>
      </template>
    </div>
  </div>

  {% endblock %}
</div>
